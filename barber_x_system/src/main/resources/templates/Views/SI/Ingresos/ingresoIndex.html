<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<title>Ingresos | BarberXsystem</title>
	<link rel="stylesheet" th:href="@{/css/bootstrap2.min.css}">
	<link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
	<link rel="stylesheet" th:href="@{/css/main.css}">
	<link rel="shotcut icon" th:href="@{/img/logo.png}">
	<script src="https://kit.fontawesome.com/eb1bb051d4.js"></script>
</head>
<body>
	<section th:replace="plantilla/plantilla :: sidebar"></section>
	<section class="full-box dashboard-contentPage">
		<nav th:replace="plantilla/plantilla :: navbar"></nav>
		<div class="container-fluid">
			<div class="col px-0">
				<div class="alert alert-success alert-dismissible show mt-2" role="alert" th:if="${success}">
				  <i class="far fa-check-circle mr-1"></i>
				  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
				    <span aria-hidden="true">&times;</span>
				  </button>
				  <strong th:text="${success}"></strong>
				</div>
				<div class="alert alert-danger alert-dismissible show mt-2" role="alert" th:if="${error}">
				  <i class="far fa-times-circle mr-1"></i>
				  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
				    <span aria-hidden="true">&times;</span>
				  </button>
				  <strong th:text="${error}"></strong>
				</div>
				<div class="alert alert-warning alert-dismissible show mt-2" role="alert" th:if="${warning}">
				  <i class="fas fa-exclamation-circle mr-1"></i>
				  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
				    <span aria-hidden="true">&times;</span>
				  </button>
				  <strong th:text="${warning}"></strong>
				</div>
				<div class="alert alert-info alert-dismissible show mt-2" role="alert" th:if="${info}">
				  <i class="fas fa-info-circle mr-1"></i>
				  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
				    <span aria-hidden="true">&times;</span>
				  </button>
				  <strong th:text="${info}"></strong>
				</div>
			</div>
		</div>
		<div class="container-fluid">
			<div class="page-header">
			  <h1 class="text-titles"><i class="zmdi zmdi-font zmdi-hc-fw"></i> Ingresos <small>Nuevo ingreso</small></h1>
			</div>
		</div>
		<div class="container-fluid pb-4">
			<div class="row justify-content-center">
				<div class="col-xs-12">
					<ul class="nav nav-tabs" style="margin-bottom: 15px;">
					  	<li><a th:classappend="${mode ? 'disabled' : ''}" class="nav-link" th:href="@{/ingreso/preparar}">Nuevo ingreso</a></li>
					  	<li><a th:classappend="${mode ? '' : 'disabled'}" class="nav-link" href="#modalAddCliente" data-toggle="modal">Agregar Cliente</a></li>
					  	<li><a th:classappend="${recibo.usuario == null ? 'disabled' : ''}" class="nav-link" href="#modalAddCita" data-toggle="modal">Agregar cita</a></li>
					</ul>
				</div>
			</div>
			<div class="row justify-content-center">
				<div class="col-7">
					<h2 class="text-titles text-center">Servicios / Productos</h2>
					<table class="table table-borderless table-hover text-center">
						  <thead>
						    <tr>
						      <th scope="col">ID</th>
						      <th scope="col">Servicio / Producto</th>
						      <th scope="col">Precio</th>
						      <th scope="col">Agregar</th>
						    </tr>
						  </thead>
						  <tbody>
						    <tr th:each="ps:${prodsServs}">
						      <th scope="row" th:text="${ps.idProductoServ}"></th>
						      <td th:text="${ps.nombre}"></td>
						      <td th:text="${'$'+ps.precioVenta}"></td>
						      <td>
						      	<a href="#modalCantidad" data-toggle="modal" class="text-success p-0 btn-cant">
						      		<i class="fas fa-plus-circle"></i>
						      		<input type="hidden" id="prodServ" name="prodServ" th:value="${ps.idProductoServ}">
						      	</a>
						      </td>
						    </tr>
						  </tbody>
					</table>
				</div>
			</div>
			<hr>
			<div class="row justify-content-center">
				<div class="col-7">
					<div class="jumbotron">
						<h2 class="text-titles justify-content-between d-flex">
							<span>Ingreso</span>
							<span th:text="${recibo.numeroRecibo}"></span>
						</h2>
						<h2 class="text-titles justify-content-between d-flex" th:if="${recibo.usuario != null}">
							<span>Cliente</span>
							<span th:text="${recibo.usuario.nombres+' '+recibo.usuario.apellidos}"></span>
						</h2>
						<h2 class="text-titles justify-content-between d-flex" th:if="${recibo.cita != null}">
							<span>Cita</span>
							<span th:text="${recibo.cita.idCita}"></span>
						</h2>
						<h2 class="text-titles justify-content-between d-flex">
							<span>Total</span>
							<span th:text="${'$'+recibo.total}"></span>
						</h2>
					</div>
				</div>
			</div>
			<hr>
			<div class="row justify-content-center">
				<div class="col-7">
					<h2 class="text-titles text-center">Detalles agregados</h2>
					<table class="table table-borderless table-hover text-center">
						  <thead>
						    <tr>
						      <th scope="col">ID</th>
						      <th scope="col">Servicio / Producto</th>
						      <th scope="col">Precio</th>
						      <th scope="col">Cantidad</th>
						      <th scope="col">Subtotal</th>
						      <th scope="col">Quitar</th>
						    </tr>
						  </thead>
						  <tbody>
						    <tr th:each="d:${detalles}">
						      <th scope="row" th:text="${d.idDetalle}"></th>
						      <td th:text="${d.prodServ.nombre}"></td>
						      <td th:text="${'$'+d.prodServ.precioVenta}"></td>
						      <td th:text="${d.cantidad}"></td>
						      <td th:text="${'$'+d.subtotal}"></td>
						      <td>
						      	<a th:href="@{/ingreso/quitar-producto-servicio/}+${d.idDetalle - 1}" class="p-0 text-danger">
						      		<i class="fas fa-times-circle"></i>
						      	</a>
						      </td>
						    </tr>
						  </tbody>
					</table>
					<a th:classappend="${mode ? '' : 'disabled'}" th:href="@{/ingreso/cancelar}" class="btn btn-secondary btn-raised">Cancelar</a>
					<a th:classappend="${mode ? '' : 'disabled'}" href="#modalEfectivo" data-toggle="modal" class="btn btn-success btn-raised float-right">Cobrar ingreso</a>
				</div>
			</div>
		</div>
	</section>
	<footer th:replace="plantilla/plantilla :: footer-scripts"></footer>
	
	<div th:include="Views/SI/Ingresos/modalCantidad.html" th:remove="tag"></div>
	<div th:include="Views/SI/Ingresos/modalAddCliente.html" th:remove="tag"></div>
	<div th:include="Views/SI/Ingresos/modalAddCita.html" th:remove="tag"></div>
	<div th:include="Views/SI/Ingresos/modalEfectivo.html" th:remove="tag"></div>

	<script>
		$('document').ready(function(){
			
			$('[data-toggle="tooltip"]').tooltip();
			
			$('.table .btn-cant').on('click', function(){
				var idProdServ = $(this).parent().find('#prodServ').val();
				$.ajax({
					type: 'GET',
					url: '/ingreso/producto-servicio/details/'+idProdServ,
					success: function(prodServ){
						$('#modalCantidad #idProductoServicio').val(idProdServ);
						$('#modalCantidad #nombreProdServ').text(prodServ.nombre);
					}
				});
			});	
			
		});
	</script>
</body>
</html>